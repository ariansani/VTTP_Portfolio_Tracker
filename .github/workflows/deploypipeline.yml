name: deploy heroku, publish release
on:
  push:
    tags:
      - 'v*'
jobs:
  release-on-push:
    name: Create Release
    runs-on: ubuntu-latest
    env:
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    steps:
      - uses: rymndhng/release-on-push-action@master
        with:
          bump_version_scheme: minor
  deploy-heroku:
    runs-on: ubuntu-latest
    - name: Checkout my repository
      uses: actions/checkout@v3
    - name: DeployHeroku with github secrets
      uses: akhileshns/heroku-deploy@v3.12.12 
      with:
        heroku_api_key: ${{ secrets.heroku_api_key }}
        heroku_app_name: portfolio-tracker-arian
        heroku_email: ${{ secrets.heroku_email }}
        branch: ${{ github.ref_name }}
      env:
        HD_SPRING_DATASOURCE_URL: ${{ secrets.SPRING_DATASOURCE_URL }}
        HD_SPRING_DATASOURCE_USERNAME: ${{ secrets.SPRING_DATASOURCE_USERNAME }}
        HD_SPRING_DATASOURCE_PASSWORD: ${{ secrets.SPRING_DATASOURCE_PASSWORD }}
        HD_FINNHUB_API_KEY : ${{secrets.FINNHUB_API_KEY}}