<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.0/css/all.min.css"
      integrity="sha512-10/jx2EXwxxWqCLX/hHth/vu2KY3jCF70dCQB8TSgNjbCVAC/8vai53GfMDrO2Emgwccf2pJqxct9ehpzG+MTw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <style>
      .mainContent{
        margin:2em;
      }

      .highcharts-figure,
      .highcharts-data-table table {
        min-width: 32%;
        max-width: 35%;
        float: right;
      }

      .highcharts-data-table table {
        font-family: Verdana, sans-serif;
        border-collapse: collapse;
        border: 1px solid #ebebeb;
        margin: 10px auto;
        width: 100%;
        max-width: 500px;
      }

      .highcharts-data-table caption {
        padding: 1em 0;
        font-size: 1.2em;
        color: #555;
      }

      .highcharts-data-table th {
        font-weight: 600;
        padding: 0.5em;
      }

      .highcharts-data-table td,
      .highcharts-data-table th,
      .highcharts-data-table caption {
        padding: 0.5em;
      }

      .highcharts-data-table thead tr,
      .highcharts-data-table tr:nth-child(even) {
        background: #f8f8f8;
      }

      .highcharts-data-table tr:hover {
        background: #f1f7ff;
      }
      #chartContainer {
        height: 400px;
        min-width: 60% !important;
        max-width: 65% !important;
        position: relative;
        float: left;
      }
      #highCharts {
        margin: auto;
      }

      /* nav styling */
      .side-navbar {
        width: 264px;
        height: 100%;
        position: fixed;
        margin-left: -440px;
        background-color: #323284;
        transition: 0.5s;
      }
      .nav-link:active,
      .nav-link:focus,
      .nav-link:hover {
        background-color: #ffffff26;
        font-weight: 700;
        color:white;
      }
      .my-container {
        transition: 0.4s;
      }
      .active-nav {
        margin-left: 0;
      }
      /* for main section */
      .active-cont {
        margin-left: 264px;
      }
      #menu-btn {
        background-color: #7c788b;
        color: #fff;
        z-index: 10;
      }
      li.nav-link {
        color: white;
        font-weight: 300;
        font-size:large;
        text-decoration: none;
    }
    p{
      margin-bottom:0;
    }
    a {
      text-decoration: none !important;
      }
    </style>
  </head>
  <body>
    <div
      class="side-navbar active-nav d-flex justify-content-between flex-wrap flex-column"
      id="sidebar"
    >
    <ul class="nav flex-column text-white w-100">
      <a href="#" class="nav-link h3 text-white my-2"> Portfolio Tracker </a>
      <a href="/protected/dashboard"><li class="nav-link">
        <span class="mx-2"><i class="fa fa-xl fa-duotone fa-cubes-stacked"></i> Dashboard</span>
      </li></a>
      <a href="/protected/manage/portfolio"><li class="nav-link">
        <span class="mx-2"><i class="fa fa-xl fa-duotone fa-people-roof"></i> Manage Portfolio</span>
      </li></a>
      <a href="/logout"><li class="nav-link">
        <span class="mx-2"><i class="fa fa-xl fa-duotone fa-door-open"></i> Logout</span>
      </li></a>
    </ul>
    </div>

    <div class="p-1 my-container active-cont">
      <a class="btn border-0" id="menu-btn">
        <i class="fa fa-light fa-bars"></i><p>Menu</p>
      </a>

      <div class="mainContent">

        <div id="highCharts">
          <div id="chartContainer"></div>
          <figure class="highcharts-figure">
            <div id="container"></div>
          </figure>
        </div>

        <div style="clear: both; text-align: center">
          <h3 style="display: inline-block; margin: auto">
            Portfolio Holdings<span
              data-th-text="${#numbers.formatDecimal(aum,1,2,'POINT')}"
            ></span>
          </h3>
      
        </div>
        <table border="1" id="portfolio" class="display">
          <thead>
            <tr>
              <th>Ticker Symbol</th>
              <th>Quantity</th>
              <th>Cost Basis</th>
              <th>Current Price</th>
              <th>Profit/Loss($)</th>
              <th>Total Value</th>
            </tr>
          </thead>
          <tbody>
            <tr data-th-each="holding : ${holdings}">
              <td data-th-text="${holding.getSymbol}"></td>
              <td data-th-text="${holding.getQuantity}"></td>
              <td
                data-th-text="${#numbers.formatDecimal(holding.getCostBasis,1,2,'POINT')}"
              ></td>
              <td
                data-th-text="${#numbers.formatDecimal(holding.getCurrentPrice,1,2,'POINT')}"
              ></td>
              <td
                data-th-style="${#numbers.formatDecimal(holding.getProfitLoss,1,2,'POINT')} <=0 ? 'color:red;' : 'color:green;'"
                data-th-text="${#numbers.formatDecimal(holding.getProfitLoss,1,2,'POINT')}"
              ></td>
              <td
                data-th-text="${#numbers.formatDecimal(holding.getTotalValue,1,2,'POINT')}"
              ></td>
            </tr>
          </tbody>
        </table>

     
      </div>
      <!--end of main content-->
    </div>
    <script
      src="https://code.jquery.com/jquery-3.6.0.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
      crossorigin="anonymous"
    ></script>
    <script
      type="text/javascript"
      charset="utf8"
      src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"
    ></script>
    <script src="https://code.highcharts.com/stock/highstock.js"></script>
    <script src="https://code.highcharts.com/stock/modules/data.js"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/heatmap.js"></script>
    <script src="https://code.highcharts.com/modules/treemap.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
  </body>
</html>

<script th:inline="javascript">
  $(document).ready(function () {
    $("#portfolio").DataTable();

    var menu_btn = document.querySelector("#menu-btn");
    var sidebar = document.querySelector("#sidebar");
    var container = document.querySelector(".my-container");
    menu_btn.addEventListener("click", () => {
      sidebar.classList.toggle("active-nav");
      container.classList.toggle("active-cont");
    });

    let treeMapData = /*[[${holdings}]]*/ [];

    var series = [];
    let data = [];
    for (var i = 0; i < treeMapData.length; i++) {
      var object = {};
      object.name =
        treeMapData[i].symbol + "<br/>" + treeMapData[i].percentageChange;
      object.value = treeMapData[i].quantity * treeMapData[i].currentPrice;
      object.colorValue = treeMapData[i].percentageChange;
      data.push(object);
    }
    var seriesObject = {
      type: "treemap",
      layoutAlgorithm: "squarified",
      data: data,
    };
    series.push(seriesObject);
    drawHeatmap(series);

    function drawHeatmap(series) {
      Highcharts.chart("container", {
        colorAxis: {
          minColor: "#D10000",
          maxColor: "#00D100",
        },
        series: series,
        title: {
          text: "Today's Performance",
        },
        // tooltip:
        // {
        //   formatter: function () {
        //     return "<strong>" + this.key + ": </strong>" + this.y;
        //   },
        // },
      });
    }

    var seriesOptions = [],
      seriesCounter = 0,
      names = ["MSFT", "AAPL", "GOOG"];

    /**
     * Create the chart when all data is loaded
     * @return {undefined}
     */
    function createChart() {
      Highcharts.stockChart("chartContainer", {
        rangeSelector: {
          selected: 4,
        },

        yAxis: {
          labels: {
            formatter: function () {
              return (this.value > 0 ? " + " : "") + this.value + "%";
            },
          },
          plotLines: [
            {
              value: 0,
              width: 2,
              color: "silver",
            },
          ],
        },

        plotOptions: {
          series: {
            compare: "percent",
            showInNavigator: true,
          },
        },

        tooltip: {
          pointFormat:
            '<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b> ({point.change}%)<br/>',
          valueDecimals: 2,
          split: true,
        },

        series: seriesOptions,
        title: {
          text: "Normalized Performance (Annual)",
        },
      });
    }

    function success(data) {
      var name = this.url.match(/(msft|aapl|goog)/)[0].toUpperCase();
      var i = names.indexOf(name);
      seriesOptions[i] = {
        name: name,
        data: data,
      };

      // As we're loading the data asynchronously, we don't know what order it
      // will arrive. So we keep a counter and create the chart when all the data is loaded.
      seriesCounter += 1;

      if (seriesCounter === names.length) {
        createChart();
      }
    }

    Highcharts.getJSON(
      "https://cdn.jsdelivr.net/gh/highcharts/highcharts@v7.0.0/samples/data/msft-c.json",
      success
    );
    Highcharts.getJSON(
      "https://cdn.jsdelivr.net/gh/highcharts/highcharts@v7.0.0/samples/data/aapl-c.json",
      success
    );
    Highcharts.getJSON(
      "https://cdn.jsdelivr.net/gh/highcharts/highcharts@v7.0.0/samples/data/goog-c.json",
      success
    );
  });
</script>
